<!DOCTYPE html>
<html>
<head>
    <title>Exercicio 10</title>
    <meta charset="UTF-8">
</head>
<body>
    <h1>Itens mais vendidos</h1>

    <label for="description_filter">Filtro por descrição: </label>
    <input id="description_filter" type="text">
    <button onclick="loadItems(document.getElementById('description_filter').value)">Filtrar</button>
    <ul id="items"></ul>

    <script type="application/javascript">
        function getItems(description, onSuccess, onError) {
            var ajax = new XMLHttpRequest();
            ajax.onreadystatechange = function() {
                if (ajax.readyState === 4) {
                    if (ajax.status === 200) {
                        var jsonText = ajax.responseText;
                        var jsonObject = JSON.parse(jsonText);
                        onSuccess(jsonObject);
                    } else {
                        onError(ajax.responseText);
                    }
                }
            };

            var desc = description != null ? 'descricao=' + description : '';
            ajax.open('GET', 'http://localhost:8080/api/v1/products?' + desc, true);
            ajax.send(null);
        }

        function loadItems(description) {
            getItems(description, function(products) {
                var ul = document.getElementById('items');
                ul.innerText = '';
                for(var i = 0; i < products.length; i++) {
                    var product = products[i];
                    var li = document.createElement("li");
                    li.innerHTML =
                        '<p>Nome: ' + product['nome'] + '</p>' +
                        '<p>Descrição: ' + product['descricao'] + '</p>' +
                        '<p>Detalhes: ' + product['detalhes'] + '</p>'
                    ul.appendChild(li);
                }
            }, function(error) {
                console.error(error);
            });
        }

        loadItems();
    </script>
</body>
</html>
